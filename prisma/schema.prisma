generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ステータス用のenum
enum WorkStatus {
  WORKING
  COMPLETED 
  PAUSED
}

// ヘルスチェック用のモデル
model HealthCheck {
  id         Int      @id @default(autoincrement())
  created_at DateTime @default(now())
}

// プロジェクト
model Project {
  id          String   @id @default(cuid())
  name        String
  description String?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  // リレーション
  tags            Tag[]
  works           Work[]
  slack_integration SlackIntegration? // 1対1のリレーション

  @@map("projects")
}

// 作業のタグ
model Tag {
  id         String   @id @default(cuid())
  project_id String
  name       String
  color      String   @default("#667eea")
  created_at DateTime @default(now())
  
  // リレーション
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@map("tags")
}

// 作業記録
model Work {
  id             String     @id @default(cuid())
  project_id     String
  user_name      String
  planned_task   String?
  actual_task    String?
  remaining_task String?
  status         WorkStatus @default(WORKING)
  started_at     DateTime   @default(now())
  ended_at       DateTime?
  created_at     DateTime   @default(now())
  tag_ids        Json?      // タグIDの配列をJSONで保存
  
  // リレーション
  project        Project    @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@map("work")
}

// Slack連携設定
model SlackIntegration {
  id          String   @id @default(cuid())
  project_id  String   @unique
  webhook_url String
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  // リレーション
  project     Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@map("slack_integrations")
}

